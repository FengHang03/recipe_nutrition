# 🐕🐱 宠物能量需求计算器

## 📖 概述

这是一个专业的宠物能量需求计算器，基于兽医营养学标准，能够准确计算狗和猫在不同生命阶段、活动水平和生理状态下的每日能量需求。

## ✨ 功能特点

### 🧮 核心计算功能
- **静息能量需求 (RER)**: 使用标准公式 `RER = 70 × (体重kg)^0.75`
- **每日能量需求 (DER)**: 根据多个因素综合计算
- **生命阶段考虑**: 幼犬/幼猫需要更多能量支持生长
- **活动水平调整**: 5个不同的活动水平系数
- **特殊生理状态**: 支持怀孕、哺乳、绝育等状态
- **老年调整**: 老年宠物(>7岁)的能量需求调整

### 🐕 犬类特殊支持
- **幼犬阶段**: 0-4个月 (3.0倍系数), 4-12个月 (2.5倍系数)
- **怀孕期**: `1.8 × RER + 26 × 体重`
- **哺乳期**: 根据哺乳周数和幼犬数量精确计算
- **绝育调整**: 活动系数减少0.2

### 🐱 猫类特殊支持
- **幼猫阶段**: 0-12个月 (2.5倍系数)
- **室内猫**: 通常活动水平较低
- **绝育调整**: 活动系数减少0.2

## 📁 文件结构

```
backend/
├── app/
│   ├── services/
│   │   └── energy_calculate.py      # 🧮 核心计算器类
│   ├── test/
│   │   ├── test_energy_calculator.py    # 🧪 完整单元测试
│   │   └── demo_energy_calculator.py    # 🎭 功能演示程序
│   └── db/
│       └── models.py                # 📊 数据模型定义
├── run_energy_tests.py             # 🚀 统一测试运行脚本
└── README_energy_calculator.md     # 📖 本文件
```

## 🚀 快速开始

### 基础使用

```python
from app.services.energy_calculate import EnergyCalculator
from app.db.models import ActivityLevel, PhysiologicalStatus, Species

calculator = EnergyCalculator()

# 计算15kg成年拉布拉多的能量需求
result = calculator.calculate_daily_energy_requirement(
    weight_kg=15.0,
    species=Species.DOG,
    age_months=36,
    activity_level=ActivityLevel.HIGH_ACTIVE,
    physiological_status=PhysiologicalStatus.INTACT
)

print(f"静息能量需求: {result['resting_energy_kcal']} kcal/day")
print(f"每日能量需求: {result['daily_energy_kcal']} kcal/day")
print(f"生命阶段: {result['life_stage']}")
```

### 运行测试和演示

我们提供了多种测试和演示方式：

#### 1️⃣ 使用统一脚本（推荐）

```bash
cd backend
python run_energy_tests.py
```

这会显示一个菜单，让你选择：
1. 🧪 单元测试 - 运行完整的测试套件
2. 🎭 演示程序 - 查看详细的计算演示
3. 🚀 简单测试 - 快速验证功能
4. 🎮 交互式测试 - 手动输入参数测试

#### 2️⃣ 直接运行特定模式

```bash
# 运行单元测试
python run_energy_tests.py test

# 运行演示程序
python run_energy_tests.py demo

# 运行简单测试
python run_energy_tests.py simple

# 运行交互式测试
python run_energy_tests.py interactive
```

#### 3️⃣ 直接运行文件

```bash
# 运行单元测试
python -m pytest app/test/test_energy_calculator.py -v

# 运行演示程序
python app/test/demo_energy_calculator.py
```

## 🧪 测试说明

### 单元测试 (test_energy_calculator.py)

包含以下测试类别：
- ✅ **基础RER计算测试**: 验证静息能量需求计算
- ✅ **活动系数测试**: 验证不同活动水平的系数
- ✅ **生命阶段测试**: 验证狗和猫的生命阶段判断
- ✅ **正常成年宠物测试**: 基础能量需求计算
- ✅ **幼体测试**: 幼犬/幼猫的高能量需求
- ✅ **绝育状态测试**: 绝育后的能量需求调整
- ✅ **老年宠物测试**: 老年宠物的特殊需求
- ✅ **怀孕期测试**: 怀孕母犬的能量需求
- ✅ **哺乳期测试**: 不同哺乳周数和幼崽数量的计算
- ✅ **边界情况测试**: 输入验证和错误处理
- ✅ **返回格式测试**: 确保输出格式正确

### 演示程序 (demo_energy_calculator.py)

提供直观的功能展示：
- 📊 **基础计算演示**: RER和活动系数对比
- 🎯 **生命阶段对比**: 不同年龄的系数变化
- 🔍 **详细计算过程**: 步骤分解和公式展示
- 🤰 **特殊状态演示**: 怀孕、哺乳、绝育对比
- 📋 **对比表格**: 多种宠物类型的能量需求对比
- 🚫 **错误处理展示**: 输入验证演示

## 📊 计算公式详解

### 基础公式

1. **静息能量需求 (RER)**
   ```
   RER = 70 × (体重kg)^0.75
   ```

2. **每日能量需求 (DER) - 正常状态**
   ```
   DER = RER × 生命阶段系数 × 活动系数
   ```

### 特殊状态公式

3. **怀孕期 (母犬)**
   ```
   DER = 1.8 × RER + 26 × 体重kg
   ```

4. **哺乳期 (母犬)**
   ```
   DER = 2 × RER × 体重 × 幼犬系数 × 哺乳周系数
   
   幼犬系数:
   - ≤4只: 24 × 幼犬数
   - >4只: 96 + 12 × (幼犬数-4)
   
   哺乳周系数:
   - 第1周: 0.75
   - 第2周: 0.95  
   - 第3周: 1.1
   - 第4周: 1.2
   ```

### 系数说明

#### 生命阶段系数
| 物种 | 年龄 | 系数 | 说明 |
|------|------|------|------|
| 犬 | 0-4个月 | 3.0 | 快速生长期 |
| 犬 | 4-12个月 | 2.5 | 生长期 |
| 犬 | >12个月 | 1.0 | 成年期 |
| 猫 | 0-12个月 | 2.5 | 生长期 |
| 猫 | >12个月 | 1.0 | 成年期 |

#### 活动水平系数
| 活动水平 | 系数 | 适用情况 |
|----------|------|----------|
| 久坐 | 1.4 | 室内宠物，很少运动 |
| 低活动 | 1.6 | 偶尔散步，轻度活动 |
| 中等活动 | 1.8 | 每日散步，正常活动 |
| 高活动 | 2.0 | 频繁运动，工作犬 |
| 极高活动 | 2.2 | 运动犬，高强度训练 |

#### 特殊调整
- **绝育**: 活动系数 -0.2 (最低1.0)
- **老年** (>84个月): 活动系数 -0.2 (最低1.0)

## 🎯 使用场景

### 宠物主人
- 📏 确定宠物的每日食物份量
- 🎯 制定喂养计划
- ⚖️ 监控宠物体重管理

### 兽医和营养师
- 🏥 临床营养评估
- 📋 制定治疗饮食方案
- 📊 营养需求分析

### 宠物食品制造商
- 🥘 产品营养标准制定
- 📦 包装喂养指南
- 🔬 配方验证

## ⚠️ 使用注意事项

1. **仅供参考**: 本计算器提供的是理论估算值，实际需求可能因个体差异而变化
2. **兽医咨询**: 特殊健康状况的宠物应咨询兽医
3. **监控调整**: 应根据宠物体重变化调整食量
4. **品种差异**: 不同品种可能有不同的代谢率

## 🔧 开发说明

### 依赖项
- Python 3.7+
- SQLAlchemy (用于数据模型)
- pytest (用于测试)

### 扩展开发
如需添加新功能，请参考：
- `EnergyCalculator`类的方法结构
- 现有的测试用例格式
- 枚举类型定义

### 代码质量
- ✅ 类型提示
- ✅ 详细文档字符串
- ✅ 输入验证
- ✅ 错误处理
- ✅ 全面的单元测试

## 📝 更新日志

### v1.0.0
- ✨ 初始版本发布
- 🧮 基础能量计算功能
- 🧪 完整测试套件
- 🎭 演示程序
- 📖 详细文档

## 🤝 贡献

欢迎提交Bug报告和功能建议！请确保新功能都有相应的测试覆盖。

## 📄 许可证

本项目采用MIT许可证。 